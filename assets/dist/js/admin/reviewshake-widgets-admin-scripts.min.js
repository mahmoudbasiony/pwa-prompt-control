"use strict";function _asyncToGenerator(e){return function(){var i=e.apply(this,arguments);return new Promise(function(n,o){return function t(e,r){try{var s=i[e](r),a=s.value}catch(e){return void o(e)}if(!s.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});n(a)}("next")})}}!function(v){v(document).on("change",".review-sources",function(e){var t=v(this).find("option:selected").data("placeholder-url");v(this).closest(".review-sources-row").find(".review-sources-url").attr("placeholder",t)}),v(document).on("submit","#create_review_source_form",function(e){e.preventDefault();var t=v(this),r=t.find('input[name="source_url"]').val(),s=t.find('select[name="source_name"] option:selected').val().toLowerCase(),a=t.data("account-exists"),e=(parseInt(t.attr("data-review-source-id")),!1);if(t.find(".error").remove(),s.length<=0&&(t.find(".review-sources").after('<span class="error">'+reviewshake_widgets_params.translations.required+"</span"),e=!0),r.length<=0&&(t.find(".review-sources-url").after('<span class="error">'+reviewshake_widgets_params.translations.required+"</span"),e=!0),e)return!1;m("reviewshake-widgets-setup-wrap",t),h(s,r,t,a)}),v(document).on("click",".delete-review-source",function(e){e.preventDefault();var t=v(this).closest(".review-sources-row"),e=t.data("review-source-id"),e=parseInt(e.replace("rs",""));confirm(reviewshake_widgets_params.translations.confirm_delete)&&(m("reviewshake-widgets-setup-wrap",t),l(e,t))}),v(document).on("click",".delete-widget",function(e){e.preventDefault();var t=v(this).closest(".reviewshake-widgets-widget"),e=t.attr("data-widget-id");confirm(reviewshake_widgets_params.translations.confirm_delete)&&(m("reviewshake-widgets-setup-wrap",t),w(e,t))}),v(document).on("click",".widget_min_star_rating .star_rating",function(e){v(".star_rating").removeClass("selected");for(var t=[],r=v(this).data("star-rate"),s=1;s<r;s++)t.push(s);t=JSON.stringify(t),v(this).addClass("selected"),v(this).closest(".widget_min_star_rating").find('input[name="ex_star_rating"]').val(t)}),v(document).on("submit","#create_widget_form",function(e){e.preventDefault();var t=v(this),r=parseInt(t.attr("data-widget-id")),s=t.find('input[name="name"]').val(),a=t.find('select[name="widget_type"] option:selected').val(),e=!1;if(t.find(".error").remove(),s.length<=0&&(t.find('input[name="name"]').after('<span class="error">'+reviewshake_widgets_params.translations.required+"</span"),e=!0),a.length<=0&&(t.find('select[name="widget_type"]').after('<span class="error">'+reviewshake_widgets_params.translations.required+"</span"),e=!0),e)return v("html, body").animate({scrollTop:v(".error").first().offset().top-70},800),!1;e=new FormData(t[0]),e=Object.fromEntries(e.entries());console.log(e),r?(r=parseInt(r),e.id=r,p(t,e)):u(t,e)}),v(document).on("click",".add-new-widget, .edit-widget",function(e){e.preventDefault();e=v(this).closest(".reviewshake-widgets-widget"),e=e.attr("data-widget-id")?e.attr("data-widget-id"):0,e={action:"reviewshake_renders_widget_form",nonce:reviewshake_widgets_params.nonce,widget_id:e};d(e).then(function(e){e.success&&e.hasOwnProperty("data")&&e.data.hasOwnProperty("form")&&(e=e.data.form,v(".reviewshake-widgets-setup-wrap").remove(),postscribe("#reviewshake-widgets-setup",e),v("html, body").animate({scrollTop:v("#reviewshake-widgets").offset().top-30},200),v(".color_field").wpColorPicker())})}),v(document).on("submit","#connect_account_form",function(e){e.preventDefault();var t=v(this),r=t.find('input[name="subdomain"]').val(),s=t.find('input[name="api_key"]').val(),e=!1;if(t.find(".error").remove(),r.length<=0&&(t.find('input[name="subdomain"]').after('<span class="error">'+reviewshake_widgets_params.translations.required+"</span"),e=!0),s.length<=0&&(t.find('input[name="api_key"]').after('<span class="error">'+reviewshake_widgets_params.translations.required+"</span"),e=!0),e)return!1;confirm(reviewshake_widgets_params.translations.another_account)&&(m("reviewshake-widgets-account",t),c(r,s))}),v(document).on("click",".connect-another-account",function(e){e.preventDefault();e=reviewshake_widgets_params.newAccountForm;v(".reviewshake-widgets-account-wrap").replaceWith(e)}),v(document).on("click","#claim-account",function(e){e.preventDefault(),v(this).closest(".account-links-wrap").hide(),v(this).closest(".claim-account-wrap").find(".claiming-in-progress-wrap").show();e=v(this).data("href");window.open(e,"_blank")}),v(document).ready(function(){v(".color_field").wpColorPicker()}),v(document).on("click",".popup-close",function(e){y(),e.preventDefault()});var r,t,s,a,n,o,i,c=(r=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/account/"+r+"/"+t,{method:"GET",headers:{"content-type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce}});case 2:return s=e.sent,e.next=5,s.json();case 5:(s=e.sent).hasOwnProperty("data")&&s.data.hasOwnProperty("attributes")&&(s=s.html,v(".reviewshake-widgets-account").replaceWith(s)),_();case 8:case"end":return e.stop()}},e,void 0)})),function(e,t){return r.apply(this,arguments)}),d=(t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,e.prev=1,e.next=4,v.ajax({url:reviewshake_widgets_params.ajax_url,type:"POST",data:t});case 4:return r=e.sent,e.abrupt("return",r);case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0);case 11:case"end":return e.stop()}},e,void 0,[[1,8]])})),function(e){return t.apply(this,arguments)}),p=(s=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var s,a,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return f(),a=r.id,e.next=4,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/widgets/"+a,{method:"PUT",headers:{"content-type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce},body:JSON.stringify(r)});case 4:return s=e.sent,e.next=7,s.json();case 7:n=e.sent,console.log(n),n.hasOwnProperty("status")&&200===n.status&&(a=n.embed+"?v="+Date.now(),postscribe("#widget_live_preview",'<script src="'+a+'"><\/script>',{done:function(){console.log("done"),g()}})),!s.ok&&n.hasOwnProperty("message")&&n.hasOwnProperty("message")&&(a=n.message,n=n.data.detail,k(a,n,!0,"error"));case 12:case"end":return e.stop()}},e,void 0)})),function(e,t){return s.apply(this,arguments)}),u=(a=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var s,a,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return f(),e.next=3,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/widgets",{method:"POST",headers:{"content-type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce},body:JSON.stringify(r)});case 3:return s=e.sent,e.next=6,s.json();case 6:o=e.sent,console.log(o),o.hasOwnProperty("status")&&200==o.status&&(a=o.id,t.attr("data-widget-id",a),n=o.embed+"?v="+Date.now(),postscribe("#widget_live_preview",'<script src="'+n+'"><\/script>',{done:function(){console.log("done"),g()}})),!s.ok&&o.hasOwnProperty("message")&&o.hasOwnProperty("data")&&(n=o.message,o=o.data.detail,k(n,o,!0,"error"));case 11:case"end":return e.stop()}},e,void 0)})),function(e,t){return a.apply(this,arguments)}),w=(n=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var s,a,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/widgets/"+t,{method:"DELETE",headers:{"content-type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce}});case 2:return s=e.sent,e.next=5,s.json();case 5:n=e.sent,s.ok&&n.deleted?(console.log("Widget deleted successfully"),a=n.html,v("#reviewshake-widgets-setup").remove(),postscribe("#reviewshake-tab-setup",a)):v(".reviewshake-widgets-setup-wrap").show(),v(".color_field").wpColorPicker(),!s.ok&&n.hasOwnProperty("message")&&n.hasOwnProperty("data")&&(a=n.message,n=n.data.detail,k(a,n,!0,"error")),_();case 10:case"end":return e.stop()}},e,void 0)})),function(e,t){return n.apply(this,arguments)}),l=(o=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var s,a,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/review_sources/"+t,{method:"DELETE",headers:{"Content-Type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce}});case 2:return s=e.sent,e.next=5,s.json();case 5:(n=e.sent).deleted?(console.log("Review source deleted successfully!"),a=n.html,v("#reviewshake-widgets-setup").remove(),postscribe("#reviewshake-tab-setup",a)):(console.log(n),v(".reviewshake-widgets-setup-wrap").show().find(r).remove(),!s.ok&&n.hasOwnProperty("message")&&n.hasOwnProperty("data")&&(a=n.message,n=n.data.detail,k(a,n,!0,"error"))),v(".color_field").wpColorPicker(),_();case 9:case"end":return e.stop()}},e,void 0)})),function(e,t){return o.apply(this,arguments)}),h=(i=_asyncToGenerator(regeneratorRuntime.mark(function e(p,u,t,r){var w,s,a,l,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return s=parseInt(t.attr("data-sources-count")),w=t.attr("data-pricing-plan"),0===s&&""==r&&(t.addClass("first"),t.closest("#reviewshake-widgets").find(".creating-account-notice").show()),e.next=5,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/account/",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce}});case 5:return a=e.sent,e.next=8,a.json();case 8:return s=e.sent,a=s.data.attributes,s.data.links.account_domain,l=a.email,e.next=14,new Promise(function(e){return""==r?setTimeout(e,2e4):e()});case 14:h=setInterval(_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,s,a,n,o,i,c,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/account/?"+new URLSearchParams({email:l}),{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce}});case 2:return t=e.sent,e.next=5,t.json();case 5:if(!(t=e.sent).hasOwnProperty("data")||!t.data.hasOwnProperty("attributes")){e.next=39;break}if(clearInterval(h),a=t.data.attributes,t.data.id,t.data.type,r=a.api_key,s=a.account_domain,console.log("Get account created success"),console.log("before trial api"),""==w||"trial"===w)return e.next=18,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/account/"+r+"/"+s,{method:"PUT",headers:{"Content-Type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce}});e.next=20;break;case 18:e.sent,console.log("Account get a free plan");case 20:return console.log("after trial api"),e.next=23,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/widgets/",{method:"GET",headers:{"content-type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce}});case 23:return a=e.sent,e.next=26,a.json();case 26:return(d=e.sent).hasOwnProperty("rscode")&&200===d.rscode&&(o=d.hasOwnProperty("count")?parseInt(d.count):0,console.log("Widgets listed successfuly"),console.log("You have "+o+" of registered Widgets")),console.log("Account Domain "+s),i={apikey:r,subdomain:s,source:p,sourceUrl:u},e.next=32,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/review_sources/",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce},body:JSON.stringify(i)});case 32:return n=e.sent,e.next=35,n.json();case 35:(d=e.sent).hasOwnProperty("rscode")&&200==d.rscode?(console.log("Review source added successfully!"),c=d.html,o=reviewshake_widgets_params.translations.add_source_success.title,i=reviewshake_widgets_params.translations.add_source_success.message,k(o,i),setTimeout(P,5e3),v("#reviewshake-widgets-setup").remove(),postscribe("#reviewshake-tab-setup",c)):(console.log(d),v(".reviewshake-widgets-setup-wrap").show(),!n.ok&&d.hasOwnProperty("message")&&d.hasOwnProperty("data")&&(c=d.message,d=d.data.detail,k(c,d,!0,"error"))),v(".color_field").wpColorPicker(),_();case 39:case"end":return e.stop()}},e,void 0)})),5e3);case 15:case"end":return e.stop()}},e,void 0)})),function(e,t,r,s){return i.apply(this,arguments)}),m=function(e,t){t.closest("#reviewshake-widgets").find(".loader").show(),v("."+e).hide()},_=function(){v(".loader").hide(),v(".creating-account-notice").hide()},f=function(){v("#save_preview_widget").attr("disabled",!0),v("#widget_live_preview").children().remove(),v("html, body").animate({scrollTop:v(".reviewshake-widgets-create-wrap").offset().top-45},800),v(".widget_preview_loader").show()},g=function(){v(".widget_preview_loader").hide(),v("#save_preview_widget").removeAttr("disabled"),v("#finish_widget").removeAttr("disabled")},k=function(e,t){var r,s,a,n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"success",i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"";v(".reviewshake-popup-wrap").remove(),0===v(".reviewshake-popup-wrap").length&&(r=v("<div></div>").attr("class","reviewshake-popup-wrap "+i),s=v("<div></div>").attr("class","reviewshake-popup-box transform-in"),a=v("<a>&times;</a>").attr("class","close-btn popup-close").attr("href","#"),i=v("<h1>"+e+"</h2>").attr("class","popup-title"),e=v("<h2>"+t+"</h3>").attr("class","popup-message"),t=v('<img class="response " />').attr("src",reviewshake_widgets_params.successIcon),"error"===o&&(t=v('<img class="response " />').attr("src",reviewshake_widgets_params.errorIcon)),v(t).appendTo(s),v(i).appendTo(s),v(e).appendTo(s),n&&v(a).appendTo(s),v(s).appendTo(r),v("body").append(r),v(".reviewshake-popup-wrap").fadeIn(500))},y=function(){v(".reviewshake-popup-wrap").fadeOut(500),v(".reviewshake-popup-box").removeClass("transform-in").addClass("transform-out"),g(),_(),v("#finish_widget").attr("disabled",!0)},P=function(){v(".reviewshake-popup-wrap").fadeOut(800),v(".reviewshake-popup-box").removeClass("transform-in").addClass("transform-out")}}(jQuery);