"use strict";function _asyncToGenerator(e){return function(){var i=e.apply(this,arguments);return new Promise(function(n,o){return function t(e,r){try{var s=i[e](r),a=s.value}catch(e){return void o(e)}if(!s.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});n(a)}("next")})}}!function(w){w(document).ready(function(){var e,t,r=reviewshake_widgets_params.state,s=r.source_name,a=r.source_url;console.log(r),!r.hasOwnProperty("account_status")||"pending"!==r.account_status&&"on_hold"!==r.account_status&&"pending"!==r.source_status||(console.log("Pending account status"),t=(e=w("#create_review_source_form")).data("account-exists"),r=r.sec_to_sleep,console.log("sec To sleep "+r),k("reviewshake-widgets-setup-wrap",e),_(s,a,e,t,r))}),w(document).on("change",".review-sources",function(e){var t=w(this).find("option:selected").data("placeholder-url");w(this).closest(".review-sources-row").find(".review-sources-url").attr("placeholder",t)}),w(document).on("submit","#create_review_source_form",function(e){e.preventDefault();var t=w(this),r=t.find('input[name="source_url"]').val(),s=t.find('select[name="source_name"] option:selected').val().toLowerCase(),a=t.data("account-exists"),e=(parseInt(t.attr("data-review-source-id")),parseInt(t.attr("data-sources-count")),t.attr("data-pricing-plan"),!1);if(t.find(".error").remove(),s.length<=0&&(t.find(".review-sources").after('<span class="error">'+reviewshake_widgets_params.translations.required+"</span"),e=!0),r.length<=0&&(t.find(".review-sources-url").after('<span class="error">'+reviewshake_widgets_params.translations.required+"</span"),e=!0),e)return!1;k("reviewshake-widgets-setup-wrap",t),_(s,r,t,a)}),w(document).on("click",".delete-review-source",function(e){e.preventDefault();var t=w(this).closest(".review-sources-row"),e=t.data("review-source-id"),e=parseInt(e.replace("rs",""));confirm(reviewshake_widgets_params.translations.confirm_delete)&&(k("reviewshake-widgets-setup-wrap",t),m(e,t))}),w(document).on("click",".delete-widget",function(e){e.preventDefault();var t=w(this).closest(".reviewshake-widgets-widget"),e=t.attr("data-widget-id");confirm(reviewshake_widgets_params.translations.confirm_delete)&&(k("reviewshake-widgets-setup-wrap",t),v(e,t))}),w(document).on("click",".widget_min_star_rating .star_rating",function(e){w(".star_rating").removeClass("selected");for(var t=[],r=w(this).data("star-rate"),s=1;s<r;s++)t.push(s);t=JSON.stringify(t),w(this).addClass("selected"),w(this).closest(".widget_min_star_rating").find('input[name="ex_star_rating"]').val(t)}),w(document).on("submit","#create_widget_form",function(e){e.preventDefault();var t=w(this),r=parseInt(t.attr("data-widget-id")),s=t.find('input[name="name"]').val(),a=t.find('select[name="widget_type"] option:selected').val(),e=!1;if(t.find(".error").remove(),s.length<=0&&(t.find('input[name="name"]').after('<span class="error">'+reviewshake_widgets_params.translations.required+"</span"),e=!0),a.length<=0&&(t.find('select[name="widget_type"]').after('<span class="error">'+reviewshake_widgets_params.translations.required+"</span"),e=!0),e)return w("html, body").animate({scrollTop:w(".error").first().offset().top-70},800),!1;e=new FormData(t[0]),e=Object.fromEntries(e.entries());console.log(e),r?(r=parseInt(r),e.id=r,l(t,e)):h(t,e)}),w(document).on("click",".add-new-widget, .edit-widget",function(e){e.preventDefault();e=w(this).closest(".reviewshake-widgets-widget"),e=e.attr("data-widget-id")?e.attr("data-widget-id"):0,e={action:"reviewshake_renders_widget_form",nonce:reviewshake_widgets_params.nonce,widget_id:e};u(e).then(function(e){e.success&&e.hasOwnProperty("data")&&e.data.hasOwnProperty("form")&&(e=e.data.form,w(".reviewshake-widgets-setup-wrap").remove(),postscribe("#reviewshake-widgets-setup",e),w("html, body").animate({scrollTop:w("#reviewshake-widgets").offset().top-30},200),w(".color_field").wpColorPicker())})}),w(document).on("submit","#connect_account_form",function(e){e.preventDefault();var t=w(this),r=t.find('input[name="subdomain"]').val(),s=t.find('input[name="api_key"]').val(),e=!1;if(t.find(".error").remove(),r.length<=0&&(t.find('input[name="subdomain"]').after('<span class="error">'+reviewshake_widgets_params.translations.required+"</span"),e=!0),s.length<=0&&(t.find('input[name="api_key"]').after('<span class="error">'+reviewshake_widgets_params.translations.required+"</span"),e=!0),e)return!1;confirm(reviewshake_widgets_params.translations.another_account)&&(k("reviewshake-widgets-account",t),d(r,s))}),w(document).on("click",".connect-another-account",function(e){e.preventDefault();e=reviewshake_widgets_params.newAccountForm;w(".reviewshake-widgets-account-wrap").replaceWith(e)}),w(document).on("click","#claim-account",function(e){e.preventDefault(),w(this).closest(".account-links-wrap").hide(),w(this).closest(".claim-account-wrap").find(".claiming-in-progress-wrap").show();e=w(this).data("href");window.open(e,"_blank")}),w(document).ready(function(){w(".color_field").wpColorPicker()}),w(document).on("click",".popup-close",function(e){T(),e.preventDefault()});var r,t,s,a,n,o,i,c,e,p,d=(r=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/account/"+r+"/"+t,{method:"GET",headers:{"content-type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce}});case 2:return s=e.sent,e.next=5,s.json();case 5:(s=e.sent).hasOwnProperty("data")&&s.data.hasOwnProperty("attributes")&&(s=s.html,w(".reviewshake-widgets-account").replaceWith(s)),y();case 8:case"end":return e.stop()}},e,void 0)})),function(e,t){return r.apply(this,arguments)}),u=(t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,e.prev=1,e.next=4,w.ajax({url:reviewshake_widgets_params.ajax_url,type:"POST",data:t});case 4:return r=e.sent,e.abrupt("return",r);case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0);case 11:case"end":return e.stop()}},e,void 0,[[1,8]])})),function(e){return t.apply(this,arguments)}),l=(s=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var s,a,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return x(),a=r.id,e.next=4,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/widgets/"+a,{method:"PUT",headers:{"content-type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce},body:JSON.stringify(r)});case 4:return s=e.sent,e.next=7,s.json();case 7:n=e.sent,console.log(n),n.hasOwnProperty("status")&&200===n.status&&(a=n.embed+"?v="+Date.now(),postscribe("#widget_live_preview",'<script src="'+a+'"><\/script>',{done:function(){console.log("done"),P()}})),!s.ok&&n.hasOwnProperty("message")&&n.hasOwnProperty("message")&&(a=n.message,n=n.data.detail,b(a,n,!0,"error"));case 12:case"end":return e.stop()}},e,void 0)})),function(e,t){return s.apply(this,arguments)}),h=(a=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var s,a,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return x(),e.next=3,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/widgets",{method:"POST",headers:{"content-type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce},body:JSON.stringify(r)});case 3:return s=e.sent,e.next=6,s.json();case 6:o=e.sent,console.log(o),o.hasOwnProperty("status")&&200==o.status&&(a=o.id,t.attr("data-widget-id",a),n=o.embed+"?v="+Date.now(),postscribe("#widget_live_preview",'<script src="'+n+'"><\/script>',{done:function(){console.log("done"),P()}})),!s.ok&&o.hasOwnProperty("message")&&o.hasOwnProperty("data")&&(n=o.message,o=o.data.detail,b(n,o,!0,"error"));case 11:case"end":return e.stop()}},e,void 0)})),function(e,t){return a.apply(this,arguments)}),v=(n=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var s,a,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/widgets/"+t,{method:"DELETE",headers:{"content-type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce}});case 2:return s=e.sent,e.next=5,s.json();case 5:n=e.sent,s.ok&&n.deleted?(console.log("Widget deleted successfully"),a=n.html,w("#reviewshake-widgets-setup").remove(),postscribe("#reviewshake-tab-setup",a)):w(".reviewshake-widgets-setup-wrap").show(),w(".color_field").wpColorPicker(),!s.ok&&n.hasOwnProperty("message")&&n.hasOwnProperty("data")&&(a=n.message,n=n.data.detail,b(a,n,!0,"error")),y();case 10:case"end":return e.stop()}},e,void 0)})),function(e,t){return n.apply(this,arguments)}),m=(o=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var s,a,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/review_sources/"+t,{method:"DELETE",headers:{"Content-Type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce}});case 2:return s=e.sent,e.next=5,s.json();case 5:(n=e.sent).deleted?(console.log("Review source deleted successfully!"),a=n.html,w("#reviewshake-widgets-setup").remove(),postscribe("#reviewshake-tab-setup",a)):(console.log(n),w(".reviewshake-widgets-setup-wrap").show().find(r).remove(),!s.ok&&n.hasOwnProperty("message")&&n.hasOwnProperty("data")&&(a=n.message,n=n.data.detail,b(a,n,!0,"error"))),w(".color_field").wpColorPicker(),y();case 9:case"end":return e.stop()}},e,void 0)})),function(e,t){return o.apply(this,arguments)}),_=(i=_asyncToGenerator(regeneratorRuntime.mark(function e(n,o,t,r){var i,s,a,c,p,d,u=4<arguments.length&&void 0!==arguments[4]?arguments[4]:20;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s=parseInt(t.attr("data-sources-count")),i=t.attr("data-pricing-plan"),0===s&&""==r&&(t.addClass("first"),t.closest("#reviewshake-widgets").find(".creating-account-notice").show()),r.length<=0)return s={source:n,sourceUrl:o},e.next=7,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/account/",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce},body:JSON.stringify(s)});e.next=22;break;case 7:return a=e.sent,e.next=10,a.json();case 10:return a=e.sent,console.log(a),d=a.data.attributes,a.data.links.account_domain,c=d.email,console.log("beforeSleep"),e.next=18,new Promise(function(e){return""==r?setTimeout(e,1e3*u):e()});case 18:console.log("afterSleep"),p=setInterval(_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,s,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/account/?"+new URLSearchParams({email:c}),{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce}});case 2:return t=e.sent,e.next=5,t.json();case 5:if(!(t=e.sent).hasOwnProperty("data")||!t.data.hasOwnProperty("attributes")){e.next=35;break}if(clearInterval(p),a=t.data.attributes,t.data.id,t.data.type,r=a.api_key,s=a.account_domain,console.log("Get account created success"),console.log("before trial api"),""==i||"trial"===i)return e.next=18,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/account/"+r+"/"+s,{method:"PUT",headers:{"Content-Type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce}});e.next=20;break;case 18:e.sent,console.log("Account get a free plan");case 20:return console.log("after trial api"),e.next=23,f();case 23:if((a=e.sent).hasOwnProperty("rscode")&&200===a.rscode)return a=a.hasOwnProperty("count")?parseInt(a.count):0,console.log("Widgets listed successfuly"),console.log("You have "+a+" of registered Widgets"),a={apikey:r,subdomain:s,source:n,sourceUrl:o},e.next=31,g(a);e.next=34;break;case 31:e.sent,w(".color_field").wpColorPicker(),y();case 34:console.log("Account Domain "+s);case 35:case"end":return e.stop()}},e,void 0)})),5e3),e.next=32;break;case 22:return e.next=24,f();case 24:if((d=e.sent).hasOwnProperty("rscode")&&200===d.rscode)return d={apikey:"",subdomain:"",source:n,sourceUrl:o},e.next=29,g(d);e.next=32;break;case 29:e.sent,w(".color_field").wpColorPicker(),y();case 32:case"end":return e.stop()}},e,void 0)})),function(e,t,r,s){return i.apply(this,arguments)}),g=(c=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,s,a,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/review_sources/",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce},body:JSON.stringify(t)});case 2:return r=e.sent,e.next=5,r.json();case 5:(o=e.sent).hasOwnProperty("rscode")&&200==o.rscode?(console.log("Review source added successfully!"),n=o.html,s=reviewshake_widgets_params.translations.add_source_success.title,a=reviewshake_widgets_params.translations.add_source_success.message,b(s,a),setTimeout(O,3e3),w("#reviewshake-widgets-setup").remove(),postscribe("#reviewshake-tab-setup",n)):(console.log(o),w(".reviewshake-widgets-setup-wrap").show(),!r.ok&&o.hasOwnProperty("message")&&o.hasOwnProperty("data")&&(n=o.message,o=o.data.detail,b(n,o,!0,"error")));case 7:case"end":return e.stop()}},e,void 0)})),function(e){return c.apply(this,arguments)}),f=(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/widgets/",{method:"GET",headers:{"content-type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce}});case 2:return t=e.sent,console.log("Inside List"),e.next=6,t.json();case 6:return t=e.sent,e.abrupt("return",t);case 8:case"end":return e.stop()}},e,void 0)})),function(){return e.apply(this,arguments)}),k=(p=_asyncToGenerator(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:return e.sent,e.next=5,g(t);case 5:e.sent,w(".color_field").wpColorPicker(),y();case 8:case"end":return e.stop()}},e,void 0)})),function(e,t){t.closest("#reviewshake-widgets").find(".loader").show(),w("."+e).hide()}),y=function(){w(".loader").hide(),w(".creating-account-notice").hide()},x=function(){w("#save_preview_widget").attr("disabled",!0),w("#widget_live_preview").children().remove(),w("html, body").animate({scrollTop:w(".reviewshake-widgets-create-wrap").offset().top-45},800),w(".widget_preview_loader").show()},P=function(){w(".widget_preview_loader").hide(),w("#save_preview_widget").removeAttr("disabled"),w("#finish_widget").removeAttr("disabled")},b=function(e,t){var r,s,a,n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"success",i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"";w(".reviewshake-popup-wrap").remove(),0===w(".reviewshake-popup-wrap").length&&(r=w("<div></div>").attr("class","reviewshake-popup-wrap "+i),s=w("<div></div>").attr("class","reviewshake-popup-box transform-in"),a=w("<a>&times;</a>").attr("class","close-btn popup-close").attr("href","#"),i=w("<h1>"+e+"</h2>").attr("class","popup-title"),e=w("<h2>"+t+"</h3>").attr("class","popup-message"),t=w('<img class="response " />').attr("src",reviewshake_widgets_params.successIcon),"error"===o&&(t=w('<img class="response " />').attr("src",reviewshake_widgets_params.errorIcon)),w(t).appendTo(s),w(i).appendTo(s),w(e).appendTo(s),n&&w(a).appendTo(s),w(s).appendTo(r),w("body").append(r),w(".reviewshake-popup-wrap").fadeIn(500))},T=function(){w(".reviewshake-popup-wrap").fadeOut(500),w(".reviewshake-popup-box").removeClass("transform-in").addClass("transform-out"),P(),y(),w("#finish_widget").attr("disabled",!0)},O=function(){w(".reviewshake-popup-wrap").fadeOut(500),w(".reviewshake-popup-box").removeClass("transform-in").addClass("transform-out")}}(jQuery);