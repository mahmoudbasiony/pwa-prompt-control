"use strict";function _asyncToGenerator(e){return function(){var i=e.apply(this,arguments);return new Promise(function(n,o){return function t(e,r){try{var s=i[e](r),a=s.value}catch(e){return void o(e)}if(!s.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});n(a)}("next")})}}!function(v){v(document).ready(function(){var e,t=reviewshake_widgets_params.state,r=t.tab,s=t.source_name,a=t.source_url,n=t.google_place_id;console.log(t),r&&"setup"===r&&s&&a&&t.account_status&&t.source_status&&("pending"===t.account_status||"on_hold"===t.account_status||"pending"===t.source_status)&&(r=(e=v("#create_review_source_form")).data("account-exists"),t=t.sec_to_sleep,console.log("Waiting"+t+" seconds"),P("reviewshake-widgets-setup-wrap",e),y(s,a,n,e,r,t))}),v(document).on("change",".review-sources",function(e){var t=v(this).find("option:selected").data("placeholder-url");"google"===v(this).find("option:selected").val()?(v(this).closest(".review-sources-row").find(".review-sources-url-column").hide(),v(this).closest(".review-sources-row").find(".review-sources-url-column.google-places-select").show()):(v(this).closest(".review-sources-row").find(".review-sources-url-column").show(),v(this).closest(".review-sources-row").find(".review-sources-url-column.google-places-select").hide(),v(this).closest(".review-sources-row").find('input[type="text"].review-sources-url').attr("placeholder",t))}),v(document).ready(function(){_()}),v(document).on("submit","#create_review_source_form",function(e){e.preventDefault();var t=v(this),r=t.find('input[name="source_url"]').val(),s=t.find('select[name="source_name"] option:selected').val().toLowerCase(),a=t.data("account-exists"),n=(parseInt(t.attr("data-review-source-id")),"");"google"===s&&(r=t.find('select[name="source_url"] option:selected').text(),n=t.find('select[name="source_url"] option:selected').val());e=!1;if(t.find(".error").remove(),s.length<=0&&(t.find(".review-sources").after('<span class="error">'+reviewshake_widgets_params.translations.required+"</span"),e=!0),(r.length<=0||"google"===s&&(null==n||n.length<=0))&&(t.find(".error").remove(),t.find(".review-sources-url-column").append('<span class="error">'+reviewshake_widgets_params.translations.required+"</span"),e=!0),e)return!1;P("reviewshake-widgets-setup-wrap",t),y(s,r,n,t,a)}),v(document).on("click",".delete-review-source",function(e){e.preventDefault();var t=v(this).closest(".review-sources-row"),e=t.data("review-source-id"),e=parseInt(e.replace("rs",""));confirm(reviewshake_widgets_params.translations.confirm_delete)&&(P("reviewshake-widgets-setup-wrap",t),k(e,t))}),v(document).on("click","#upgrade-setup-link",function(e){e.preventDefault();var t=v(this),e=t.attr("href");window.open(e,"_blank");e={action:"reviewshake_renders_review_source_form",nonce:reviewshake_widgets_params.nonce};d(e).then(function(e){e.success&&e.hasOwnProperty("data")&&e.data.hasOwnProperty("form")&&(e=e.data.form,t.closest(".review-sources-upgrade-table").hide(),t.closest(".reviewshake-widgets-review-sources-container").append(e),v(".create-review-source-form").attr("data-requires-upgrade","1"))})}),v(document).on("click",".delete-widget",function(e){e.preventDefault();var t=v(this).closest(".reviewshake-widgets-widget"),e=t.attr("data-widget-id");confirm(reviewshake_widgets_params.translations.confirm_delete)&&(P("reviewshake-widgets-setup-wrap",t),f(e,t))}),v(document).on("click",".widget_min_star_rating .star_rating",function(e){v(".star_rating").removeClass("selected");for(var t=[],r=v(this).data("star-rate"),s=1;s<r;s++)t.push(s);t=JSON.stringify(t),v(this).addClass("selected"),v(this).closest(".widget_min_star_rating").find('input[name="ex_star_rating"]').val(t)}),v(document).on("submit","#create_widget_form",function(e){e.preventDefault();var t=v(this),r=parseInt(t.attr("data-widget-id")),s=t.find('input[name="name"]').val(),a=t.find('select[name="widget_type"] option:selected').val(),e=!1;if(t.find(".error").remove(),s.length<=0&&(t.find('input[name="name"]').after('<span class="error">'+reviewshake_widgets_params.translations.required+"</span"),e=!0),a.length<=0&&(t.find('select[name="widget_type"]').after('<span class="error">'+reviewshake_widgets_params.translations.required+"</span"),e=!0),e)return v("html, body").animate({scrollTop:v(".error").first().offset().top-70},800),!1;e=new FormData(t[0]),e=Object.fromEntries(e.entries());console.log(e),r?(r=parseInt(r),e.id=r,m(t,e)):g(t,e)}),v(document).on("click",".add-new-widget, .edit-widget",function(e){e.preventDefault();e=v(this).closest(".reviewshake-widgets-widget"),e=e.attr("data-widget-id")?e.attr("data-widget-id"):0,e={action:"reviewshake_renders_widget_form",nonce:reviewshake_widgets_params.nonce,widget_id:e};h(e).then(function(e){e.success&&e.hasOwnProperty("data")&&e.data.hasOwnProperty("form")&&(e=e.data.form,v(".reviewshake-widgets-setup-wrap").remove(),postscribe("#reviewshake-widgets-setup",e),v("html, body").animate({scrollTop:v("#reviewshake-widgets").offset().top-30},200),v(".color_field").wpColorPicker())})}),v(document).on("submit","#connect_account_form",function(e){e.preventDefault();var t=v(this),r=t.find('input[name="subdomain"]').val(),s=t.find('input[name="api_key"]').val(),e=!1;if(t.find(".error").remove(),r.length<=0&&(t.find('input[name="subdomain"]').after('<span class="error">'+reviewshake_widgets_params.translations.required+"</span"),e=!0),s.length<=0&&(t.find('input[name="api_key"]').after('<span class="error">'+reviewshake_widgets_params.translations.required+"</span"),e=!0),e)return!1;confirm(reviewshake_widgets_params.translations.another_account)&&(P("reviewshake-widgets-account",t),w(r,s))}),v(document).on("click",".connect-another-account",function(e){e.preventDefault();e=reviewshake_widgets_params.newAccountForm;v(".reviewshake-widgets-account-wrap").replaceWith(e)}),v(document).on("click","#claim-account",function(e){e.preventDefault(),v(this).closest(".account-links-wrap").hide(),v(this).closest(".claim-account-wrap").find(".claiming-in-progress-wrap").show();e=v(this).data("href");window.open(e,"_blank")}),v(document).ready(function(){v(".color_field").wpColorPicker()}),v(document).on("click",".popup-close",function(e){C(),e.preventDefault()});var t,r,s,a,n,o,i,c,u,e,d=(t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,e.prev=1,e.next=4,v.ajax({url:reviewshake_widgets_params.ajax_url,type:"POST",data:t});case 4:return r=e.sent,e.abrupt("return",r);case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0);case 11:case"end":return e.stop()}},e,void 0,[[1,8]])})),function(e){return t.apply(this,arguments)}),_=function(){v(".review-sources-row .google-places-select select").select2({ajax:{url:reviewshake_widgets_params.ajax_url,dataType:"json",delay:100,data:function(e){return{q:e.term,action:"reviewshake_google_places_predictions",nonce:reviewshake_widgets_params.nonce,input:e.term}},processResults:function(e,t){return{results:e.data}},cache:!0},placeholder:reviewshake_widgets_params.translations.google_places_placeholder,language:{noResults:function(){return reviewshake_widgets_params.translations.no_places_found}},allowClear:!0,minimumInputLength:1,templateResult:p,templateSelection:l})},p=function(e){if(e.loading)return e.text;var t=v("<div class='select2-result-places clearfix'><div class='select2-result-places__meta'><div class='select2-result-places__title'></div></div></div>");return t.find(".select2-result-places__title").text(e.text),t},l=function(e){return e.text||e.description},w=(r=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/account/"+r+"/"+t,{method:"GET",headers:{"content-type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce}});case 2:return s=e.sent,e.next=5,s.json();case 5:(s=e.sent).hasOwnProperty("data")&&s.data.hasOwnProperty("attributes")&&(s=s.html,v(".reviewshake-widgets-account").replaceWith(s)),T();case 8:case"end":return e.stop()}},e,void 0)})),function(e,t){return r.apply(this,arguments)}),h=(s=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=void 0,e.prev=1,e.next=4,v.ajax({url:reviewshake_widgets_params.ajax_url,type:"POST",data:t});case 4:return r=e.sent,e.abrupt("return",r);case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0);case 11:case"end":return e.stop()}},e,void 0,[[1,8]])})),function(e){return s.apply(this,arguments)}),m=(a=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var s,a,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return j(),a=r.id,e.next=4,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/widgets/"+a,{method:"PUT",headers:{"content-type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce},body:JSON.stringify(r)});case 4:return s=e.sent,e.next=7,s.json();case 7:n=e.sent,console.log(n),n.hasOwnProperty("status")&&200===n.status&&(a=n.embed+"?v="+Date.now(),postscribe("#widget_live_preview",'<script src="'+a+'"><\/script>',{done:function(){console.log("done"),O()}})),!s.ok&&n.hasOwnProperty("message")&&n.hasOwnProperty("message")&&(a=n.message,n=n.data.detail,R(a,n,!0,"error"));case 12:case"end":return e.stop()}},e,void 0)})),function(e,t){return a.apply(this,arguments)}),g=(n=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var s,a,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return j(),e.next=3,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/widgets",{method:"POST",headers:{"content-type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce},body:JSON.stringify(r)});case 3:return s=e.sent,e.next=6,s.json();case 6:o=e.sent,console.log(o),o.hasOwnProperty("status")&&200==o.status&&(a=o.id,t.attr("data-widget-id",a),n=o.embed+"?v="+Date.now(),postscribe("#widget_live_preview",'<script src="'+n+'"><\/script>',{done:function(){console.log("done"),O()}})),!s.ok&&o.hasOwnProperty("message")&&o.hasOwnProperty("data")&&(n=o.message,o=o.data.detail,R(n,o,!0,"error"));case 11:case"end":return e.stop()}},e,void 0)})),function(e,t){return n.apply(this,arguments)}),f=(o=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var s,a,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/widgets/"+t,{method:"DELETE",headers:{"content-type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce}});case 2:return s=e.sent,e.next=5,s.json();case 5:n=e.sent,s.ok&&n.deleted?(console.log("Widget deleted successfully"),a=n.html,v("#reviewshake-widgets-setup").remove(),postscribe("#reviewshake-tab-setup",a)):v(".reviewshake-widgets-setup-wrap").show(),v(".color_field").wpColorPicker(),_(),!s.ok&&n.hasOwnProperty("message")&&n.hasOwnProperty("data")&&(a=n.message,n=n.data.detail,R(a,n,!0,"error")),T();case 11:case"end":return e.stop()}},e,void 0)})),function(e,t){return o.apply(this,arguments)}),k=(i=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var s,a,n;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/review_sources/"+t,{method:"DELETE",headers:{"Content-Type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce}});case 2:return s=e.sent,e.next=5,s.json();case 5:(n=e.sent).deleted?(console.log("Review source deleted successfully!"),a=n.html,v("#reviewshake-widgets-setup").remove(),postscribe("#reviewshake-tab-setup",a)):(console.log(n),v(".reviewshake-widgets-setup-wrap").show().find(r).remove(),!s.ok&&n.hasOwnProperty("message")&&n.hasOwnProperty("data")&&(a=n.message,n=n.data.detail,R(a,n,!0,"error"))),v(".color_field").wpColorPicker(),_(),T();case 10:case"end":return e.stop()}},e,void 0)})),function(e,t){return i.apply(this,arguments)}),y=(c=_asyncToGenerator(regeneratorRuntime.mark(function e(a,n,o,i,t){var r,c,s,u,d,p,l,w,h=5<arguments.length&&void 0!==arguments[5]?arguments[5]:20;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=parseInt(i.attr("data-sources-count")),c=i.attr("data-pricing-plan"),0===r&&""==t&&(i.addClass("first"),i.closest("#reviewshake-widgets").find(".creating-account-notice").show()),t.length<=0)return s={source:a,sourceUrl:n,googlePlaceId:o},e.next=7,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/account/",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce},body:JSON.stringify(s)});e.next=21;break;case 7:return s=e.sent,e.next=10,s.json();case 10:return u=e.sent,console.log("beforeSleep"),e.next=14,new Promise(function(e){return""==t?setTimeout(e,1e3*h):e()});case 14:console.log("afterSleep"),w=u.data.attributes,d=u.data.links.account_domain,p=w.email,l=setInterval(_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/account/?"+new URLSearchParams({email:p}),{method:"GET",headers:{"Content-Type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce}});case 2:return t=e.sent,e.next=5,t.json();case 5:if(!(t=e.sent).hasOwnProperty("data")||!t.data.hasOwnProperty("attributes")){e.next=36;break}if(clearInterval(l),s=t.data.attributes,t.data.id,t.data.type,r=s.api_key,d=s.account_domain,console.log("Get account created success"),console.log("before trial api"),""==c||"trial"===c)return e.next=18,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/account/"+r+"/"+d,{method:"PUT",headers:{"Content-Type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce}});e.next=20;break;case 18:e.sent,console.log("Account get a free plan");case 20:return console.log("after trial api"),e.next=23,b();case 23:if((s=e.sent).hasOwnProperty("rscode")&&200===s.rscode)return s=s.hasOwnProperty("count")?parseInt(s.count):0,console.log("Widgets listed successfuly"),console.log("You have "+s+" of registered Widgets"),s={apikey:r,subdomain:d,source:a,sourceUrl:n,googlePlaceId:o},e.next=31,x(s,i);e.next=35;break;case 31:e.sent,v(".color_field").wpColorPicker(),_(),T();case 35:console.log("Account Domain "+d);case 36:case"end":return e.stop()}},e,void 0)})),5e3),e.next=32;break;case 21:return e.next=23,b();case 23:if((w=e.sent).hasOwnProperty("rscode")&&200===w.rscode)return w={apikey:"",subdomain:"",source:a,sourceUrl:n,googlePlaceId:o},e.next=28,x(w,i);e.next=32;break;case 28:e.sent,v(".color_field").wpColorPicker(),_(),T();case 32:case"end":return e.stop()}},e,void 0)})),function(e,t,r,s,a){return c.apply(this,arguments)}),x=(u=_asyncToGenerator(regeneratorRuntime.mark(function e(t,r){var s,a,n,o,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/review_sources/",{method:"POST",headers:{"Content-Type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce},body:JSON.stringify(t)});case 2:return s=e.sent,e.next=5,s.json();case 5:i=e.sent,console.log(i),i.hasOwnProperty("rscode")&&200==i.rscode&&i.hasOwnProperty("html")?(console.log("Review source added successfully!"),o=i.html,a=reviewshake_widgets_params.translations.add_source_success.title,n=reviewshake_widgets_params.translations.add_source_success.message,R(a,n),setTimeout(D,3e3),v("#reviewshake-widgets-setup").remove(),postscribe("#reviewshake-tab-setup",o)):(v(".reviewshake-widgets-setup-wrap").show(),(o=r.attr("data-requires-upgrade"))&&"1"===o&&(r.remove(),v(".review-sources-upgrade-table").show()),!s.ok&&i.hasOwnProperty("message")&&i.hasOwnProperty("data")&&(o=i.message,i=i.data.detail,R(o,i,!0,"error")));case 8:case"end":return e.stop()}},e,void 0)})),function(e,t){return u.apply(this,arguments)}),b=(e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(reviewshake_widgets_params.site_url+"/wp-json/reviewshake/v1/widgets/",{method:"GET",headers:{"content-type":"application/json","X-WP-Nonce":reviewshake_widgets_params.wp_rest_nonce}});case 2:return t=e.sent,e.next=5,t.json();case 5:return t=e.sent,e.abrupt("return",t);case 7:case"end":return e.stop()}},e,void 0)})),function(){return e.apply(this,arguments)}),P=function(e,t){t.closest("#reviewshake-widgets").find(".loader").show(),v("."+e).hide()},T=function(){v(".loader").hide(),v(".creating-account-notice").hide()},j=function(){v("#save_preview_widget").attr("disabled",!0),v("#widget_live_preview").children().remove(),v("html, body").animate({scrollTop:v(".reviewshake-widgets-create-wrap").offset().top-45},800),v(".widget_preview_loader").show()},O=function(){v(".widget_preview_loader").hide(),v("#save_preview_widget").removeAttr("disabled"),v("#finish_widget").removeAttr("disabled")},R=function(e,t){var r,s,a,n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"success",i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"";v(".reviewshake-popup-wrap").remove(),0===v(".reviewshake-popup-wrap").length&&(r=v("<div></div>").attr("class","reviewshake-popup-wrap "+i),s=v("<div></div>").attr("class","reviewshake-popup-box transform-in"),a=v("<a>&times;</a>").attr("class","close-btn popup-close").attr("href","#"),i=v("<h1>"+e+"</h2>").attr("class","popup-title"),e=v("<h2>"+t+"</h3>").attr("class","popup-message"),t=v('<img class="response " />').attr("src",reviewshake_widgets_params.successIcon),"error"===o&&(t=v('<img class="response " />').attr("src",reviewshake_widgets_params.errorIcon)),v(t).appendTo(s),v(i).appendTo(s),v(e).appendTo(s),n&&v(a).appendTo(s),v(s).appendTo(r),v("body").append(r),v(".reviewshake-popup-wrap").fadeIn(500))},C=function(){v(".reviewshake-popup-wrap").fadeOut(500),v(".reviewshake-popup-box").removeClass("transform-in").addClass("transform-out"),O(),T(),v("#finish_widget").attr("disabled",!0)},D=function(){v(".reviewshake-popup-wrap").fadeOut(500),v(".reviewshake-popup-box").removeClass("transform-in").addClass("transform-out")}}(jQuery);